import{j as e,H as S,n as de,u as ie,o as ce,r as o,q as ue,s as he,t as pe,w as xe,M as Ce,x as be,P as ge,F as g,d as fe,y as me,z as je,G as ye,I as Ee,J as we,K as ve,L as ke,Q as Ne}from"./vendor-BFaFKivp.js";import{B as Se,V as Be,P as ze,M as Fe}from"./components-CrSWwAWx.js";const Oe=({data:p,selected:l})=>{const{label:x,testCases:C,color:d}=p,i=C.length,b=l?"#2980B9":"#373737",s={background:l?"#373737":"#2980B9",width:"13px",height:"13px",border:"3px solid",borderColor:b},c={outline:`3px solid ${b}`,background:`${d||"#1c1c1e"}`};return e.jsxs("div",{className:"text-xs outline rounded relative p-2 text-[#ECF0F1] max-w-[150px] text-center",style:c,children:[e.jsx("div",{children:x}),e.jsx(S,{type:"source",position:"right",style:s}),e.jsx(S,{type:"target",position:"left",style:s}),i>0&&e.jsx("div",{className:"absolute top-[-10px] right-[-10px] w-[1.5rem] h-[1.5rem] rounded-full bg-[#E0E0E0] text-slate-700 flex items-center justify-center text-xs",children:i})]})},Pe=Oe,Ve=({data:p,selected:l})=>{const{label:x}=p,C=l?"#2980B9":"#373737",i={background:l?"#373737":"#2980B9",width:"13px",height:"13px",border:"3px solid",borderColor:C},b={outline:`3px solid ${C}`};return e.jsxs("div",{className:"text-[#ECF0F1] text-xs rounded-full w-[50px] h-[50px] flex justify-center items-center bg-[#34495E]",style:b,children:[e.jsx("div",{children:x}),e.jsx(S,{type:"source",position:"right",style:i}),e.jsx(S,{type:"target",position:"left",style:i})]})},Me=Ve,Te=({id:p,sourceX:l,sourceY:x,targetX:C,targetY:d,sourcePosition:i,targetPosition:b,markerEnd:m,data:s})=>{const[c,j,B]=de({sourceX:l,sourceY:x,targetX:C,targetY:d,sourcePosition:i,targetPosition:b});return e.jsxs(e.Fragment,{children:[e.jsx("path",{id:p,className:"stroke-[#BDC3C7] stroke-[2] fill-none",d:c,markerEnd:m}),(s==null?void 0:s.label)&&e.jsx("text",{x:j,y:B,style:{fontSize:12},textAnchor:"middle",children:s.label})]})},De=Te;function Ie(){var T,D,A;const[p,l,x]=ie([]),[C,d,i]=ce([]),[b,m]=o.useState(!1),[s,c]=o.useState(null),[j,B]=o.useState(null),{setViewport:k}=ue(),[$,F]=o.useState(!1),[G,O]=o.useState(!1),[P,V]=o.useState(!1),L=o.useCallback(()=>F(!0),[]),z=o.useCallback(()=>F(!1),[]),R=o.useCallback(()=>O(!0),[]),U=o.useCallback(()=>O(!1),[]),q={customNode:Pe,connector:Me},J={customEdge:De},[f,w]=o.useState({total:0,notstarted:0,passed:0,failed:0,blocked:0,notapplicable:0}),[Y,K]=o.useState(!1),Q=o.useCallback(()=>{K(a=>!a)},[]),v=o.useCallback(a=>{const t={total:0,notstarted:0,passed:0,failed:0,blocked:0,notapplicable:0};return a.forEach(n=>{n.data&&n.data.testCases&&n.data.testCases.forEach(r=>{t[r.status]!==void 0&&(t[r.status]+=1)})}),t.total=Object.values(t).reduce((n,r)=>n+r,0),t},[]),{addNode:W,addConnectorNode:X,exportToExcel:Z,deleteSelectedNode:_,onSave:M}=Se(p,l,d,s,m,c,j,v),ee=o.useCallback(()=>{M(),V(!1)},[M]);o.useEffect(()=>{const a=t=>{if(P){const n="You have unsaved changes. Are you sure you want to leave?";return t.returnValue=n,n}};return window.addEventListener("beforeunload",a),()=>{window.removeEventListener("beforeunload",a)}},[P]);const se=o.useCallback(a=>{x(a),V(!0)},[x]);o.useEffect(()=>{(async()=>{try{const t=await fetch("https://code-me-n0t.github.io/TestFlowManager/flow.json");if(t.ok){const n=await t.json(),{x:r=0,y=0,zoom:E=1}=n.viewport||{},u=(n.nodes||[]).map(h=>{var H,I;return{...h,position:{x:typeof((H=h.position)==null?void 0:H.x)=="number"?h.position.x:0,y:typeof((I=h.position)==null?void 0:I.y)=="number"?h.position.y:0}}}),N=(n.edges||[]).map(h=>({...h}));l(u),d(N),k({x:r,y,zoom:E}),n.nodes&&w(v(n.nodes)),j&&j.fitView()}else console.warn("Failed to load flow data: Check the flow.json")}catch(t){console.error("Failed to load flow data:",t)}})()},[l,d,k,w,j]);const te=o.useCallback(a=>d(t=>he({...a,animated:!0,type:"customEdge"},t)),[d]),oe=o.useCallback((a,t,n)=>{l(r=>{const y=r.map(u=>u.id===s.id?{...u,data:{...u.data,label:t,testCases:a,color:n},style:{...u.style,backgroundColor:n},type:"customNode"}:u),E=v(y);return w(E),y})},[s,l,w]),ne=o.useCallback((a,t)=>{l(n=>n.map(r=>r.id===t.id?{...r,selected:!0}:{...r,selected:!1})),c(t)},[l]),ae=o.useCallback(()=>{m(!0)},[]),le=o.useCallback(()=>{m(!1),c(null)},[]),re=o.useCallback(a=>{try{const t=typeof a=="string"?JSON.parse(a):a,n=t.nodes||[],r=t.edges||[],y=t.viewport||{x:0,y:0,zoom:1};l(n),d(r),k(y);const E=s==null?void 0:s.id;if(E){const N=n.find(h=>h.id===E);c(N||null)}else c(null);const u=v(n);w(u),z()}catch(t){console.error("Error selecting version:",t)}},[s,l,d,k,v,z]);return e.jsxs("div",{style:{height:"100vh",width:"100%"},children:[e.jsxs(pe,{colorMode:"dark",nodes:p,nodeTypes:q,onNodesChange:se,edges:C,edgeTypes:J,onEdgesChange:i,onConnect:te,onInit:B,fitView:!0,zoomOnScroll:!1,zoomOnDoubleClick:!1,onNodeClick:ne,onNodeDoubleClick:ae,children:[e.jsx(xe,{}),e.jsx(Ce,{}),e.jsx(be,{}),e.jsxs(ge,{position:"top-left panel",className:"flex flex-col space-y-4",children:[e.jsxs("div",{className:"button-container flex space-x-2",children:[e.jsx("button",{className:"delete p-2 rounded bg-[#3E3E3E] hover:bg-red-600 size-12",onClick:_,children:e.jsx(g,{icon:fe,size:"lg",color:"white"})}),e.jsx("button",{className:"version-history p-2 rounded bg-[#3E3E3E] hover:bg-[#2980B9] size-12",onClick:L,children:e.jsx(g,{icon:me,size:"lg",color:"white"})}),e.jsx("button",{className:"download rounded rounded bg-[#3E3E3E] hover:bg-[#2980B9] size-12",onClick:Z,children:e.jsx(g,{icon:je,size:"lg",color:"white"})}),e.jsx("button",{className:"add p-2 rounded bg-[#3E3E3E] hover:bg-[#2980B9] size-12",onClick:W,children:e.jsx(g,{icon:ye,size:"lg",color:"white"})}),e.jsx("button",{className:"connector p-2 rounded bg-[#3E3E3E] hover:bg-[#2980B9] size-12",onClick:X,children:e.jsx(g,{icon:Ee,size:"lg",color:"white"})}),e.jsx("button",{className:"save p-2 rounded bg-[#3E3E3E] hover:bg-[#2980B9] size-12",onClick:ee,children:e.jsx(g,{icon:we,size:"lg",color:"white"})}),e.jsx("button",{className:"chart p-2 rounded bg-[#3E3E3E] hover:bg-[#2980B9] size-12",onClick:R,children:e.jsx(g,{icon:ve,size:"lg",color:"white"})})]}),e.jsxs("div",{className:"w-[70%]",children:[e.jsxs("div",{className:"flex justify-between items-center text-sm p-2 bg-[#2d2d2d] opacity-70 rounded text-white",children:[e.jsxs("p",{children:["Total Test Count: ",f.total]}),e.jsx("button",{className:"dropdown-button p-2 rounded bg-[#3E3E3E] hover:bg-[#2980B9] flex items-center",onClick:Q,children:e.jsx(g,{icon:ke,size:"lg",color:"white"})})]}),Y&&e.jsxs("div",{className:"dropdown-menu mt-2 bg-[#2d2d2d] p-2 opacity-70 rounded text-white",children:[e.jsxs("p",{children:["Not Started: ",f.notstarted]}),e.jsxs("p",{children:["Passed: ",f.passed]}),e.jsxs("p",{children:["Failed: ",f.failed]}),e.jsxs("p",{children:["Blocked: ",f.blocked]}),e.jsxs("p",{children:["Not Applicable: ",f.notapplicable]})]})]})]})]}),e.jsx(Ne,{}),e.jsx(Be,{isOpen:$,onClose:z,onSelectVersion:re}),e.jsx(ze,{isOpen:G,onClose:U,testCaseData:f}),e.jsx(Fe,{isOpen:b,onClose:le,nodeId:s==null?void 0:s.id,nodeLabel:((T=s==null?void 0:s.data)==null?void 0:T.label)||"",testCases:((D=s==null?void 0:s.data)==null?void 0:D.testCases)||[],onSave:oe,borderColor:((A=s==null?void 0:s.data)==null?void 0:A.color)||"#1C1C1E"})]})}export{Ie as default};
