import{R as W,r as o,j as t,F as O,f as te,a as se,B as N,b as oe,c as ae,d as le,e as re,g as ne,v as X,E as ce,h as ie,C as Y,A as de,p as ue,i as he,k as fe,D as be}from"./vendor-BFaFKivp.js";function ge(s,u){let i;return function(...l){clearTimeout(i),i=setTimeout(()=>s.apply(this,l),u)}}const xe=W.memo(W.forwardRef(({testCase:s,onChange:u,onStatusChange:i,onCheckboxChange:l,isChecked:x,onClick:n,runAutomation:p},v)=>{const[k,b]=o.useState(!1);o.useState(null);const f=()=>{navigator.clipboard.writeText(s.id).then(()=>{b(!0),N.success("Test case ID copied!",{autoClose:1e3}),setTimeout(()=>b(!1),2e3)}).catch(()=>{N.error("Failed to copy ID.",{autoClose:1e3})})};return t.jsxs("div",{className:"py-2 flex items-center border-gray-600 space-x-5 overflow-x-hidden mr-3","data-replicated-value":s.content,onClick:n,children:[t.jsxs("label",{className:"container flex w-1",children:[t.jsx("input",{type:"checkbox",checked:x,onChange:l,className:"checkbox peer"}),t.jsx("span",{className:"checkmark rounded border border-gray-500 hover:border-gray-50 peer-checked:bg-sky-700 peer-checked:border-none"})]}),s.status!==""&&t.jsx("label",{className:"test-id-con  p-1 hover:bg-gray-800 rounded-lg",children:t.jsxs("div",{className:"cursor-pointer text-gray-600 flex items-center group",onClick:f,children:[t.jsx(O,{icon:te,className:"ease-in mr-1 text-gray-400 text-gray-600 invisible group-hover:visible transition-opacity duration-200"}),t.jsx("p",{className:"ease-in",children:String(s.id).slice(-4)})]})}),t.jsx("div",{className:`w-[80%] ${s.status==="",""}`,children:t.jsx("textarea",{ref:v,className:`px-3 bg-inherit rounded overflow-hidden resize-none w-full flex items-center 
              ${s.status===""?"text-gray-400 pl-2":"text-[#FAF9F6] pl-6"}  
              ${s.isBold?"bold-textarea focus:outline-none":"text-sm"}
            `,value:s.content,onChange:r=>u(r.target.value),placeholder:`Test case ${s.id}`,rows:s.status===""?1:""})}),t.jsx("div",{className:"status-con w-[20%] flex items-center justify-center",children:s.status!==""&&t.jsxs("select",{className:`p-1 cursor-pointer text-sm rounded focus:outline-none font-bold ${s.status==="notstarted"?"bg-yellow-200":s.status==="passed"?"bg-[#97BD61]":s.status==="failed"?"bg-rose-300":s.status==="blocked"?"bg-indigo-200":s.status==="notapplicable"?"bg-gray-300":"bg-yellow-200"}`,value:s.status,onChange:r=>i(r.target.value),children:[t.jsx("option",{className:"bg-slate-200 font-bold",value:"notstarted",children:"NOT STARTED"}),t.jsx("option",{className:"bg-slate-200 font-bold",value:"passed",children:"PASSED"}),t.jsx("option",{className:"bg-slate-200 font-bold",value:"failed",children:"FAILED"}),t.jsx("option",{className:"bg-slate-200 font-bold",value:"blocked",children:"BLOCKED"}),t.jsx("option",{className:"bg-slate-200 font-bold",value:"notapplicable",children:"NOT APPLICABLE"})]})}),t.jsx("div",{className:"automate-con w-[15%] flex items-center justify-center",children:s.status!=""&&t.jsx("button",{className:"automate p-2 rounded w-12 bg-[#3e3e3e] hover:bg-[#2980B9] ",onClick:p,children:t.jsx(O,{icon:se,size:"lg",color:"white"})})})]},s.id)})),F={DEFAULT:"#1C1C1E",SECOND:"#F39F5A",THIRD:"#9D3233"},me=({isOpen:s,onClose:u,nodeId:i,nodeLabel:l,nodeColor:x="#1C1C1E",testCases:n,onSave:p})=>{const[v,k]=o.useState(l),[b,f]=o.useState(x||F.DEFAULT),[r,y]=o.useState(n),[S,I]=o.useState([]),T=o.useRef([]),[M,g]=o.useState(x||F.DEFAULT),[d,j]=o.useState(""),[D,C]=o.useState(!1);o.useEffect(()=>{y(n)},[n,i]);const E={toastSave:()=>{N.success("Changes Saved Successfully!",{autoClose:1e3})},toastSaveError:()=>{N.error("Failed to save data. Please try again.",{autoClose:1e3})}},A=o.useCallback(ge(async()=>{try{if(!i)throw new Error("Node ID is not defined");const e=r.length,a=r.filter(w=>w.status==="passed").length,c=r.filter(w=>w.status==="failed").length,m=r.filter(w=>w.status==="notstarted").length,R=r.filter(w=>w.status==="blocked").length,K=r.filter(w=>w.status==="notapplicable").length;p&&p(r,v,b,{total:e,passed:a,failed:c,pending:m,blocked:R,notApplicable:K}),E.toastSave()}catch(e){console.error("Failed to save data:",e),E.toastSaveError()}},1e3),[r,v,b,i,p,E]),h=o.useCallback(()=>{requestAnimationFrame(()=>{const e=T.current.map(a=>a?(a.style.height="auto",a.scrollHeight):0);T.current.forEach((a,c)=>{a&&(a.style.height=`${e[c]}px`)})})},[]),P=o.useCallback(()=>{h(),A()},[h,A]),B=o.useCallback(e=>{const a=e.target.value;/^#[0-9A-Fa-f]{6}$/.test(a)?(f(a),g(a)):console.error("Invalid color format. Please use #rrggbb format.")},[]),H=o.useCallback(()=>{const e={id:Date.now(),content:"",status:"",isBold:!0};y(a=>[...a,e])},[]),L=o.useCallback((e,a)=>{y(c=>c.map(m=>m.id===e?{...m,content:a}:m))},[]),$=o.useCallback(()=>{const e={id:Date.now(),content:"",status:"notstarted"};y(a=>[...a,e])},[]),z=o.useCallback((e,a)=>{y(c=>c.map(m=>m.id===e?{...m,status:a}:m))},[]),V=o.useCallback(()=>{y(e=>e.filter(a=>!S.includes(a.id))),I([])},[S]),Z=o.useCallback(e=>{if(e.target.checked){const a=r.map(c=>c.id);I(a)}else I([])},[r]),G=o.useCallback(e=>{I(a=>a.includes(e)?a.filter(c=>c!==e):[...a,e])},[]),U=r.filter(e=>e.content.toLowerCase().includes(d.toLowerCase())),q=o.useCallback(e=>{T.current[e]&&(T.current[e].scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"}),T.current[e].focus())},[]),Q=o.useCallback(e=>{d&&(j(""),setTimeout(()=>{q(e)},0))},[d,q]);o.useEffect(()=>{s&&(k(l),f(x||F.DEFAULT),y(n),I([]))},[l,n,x,s]),o.useEffect(()=>{const e=JSON.parse(localStorage.getItem(`testCases-${i}`)),a=localStorage.getItem(`label-${i}`),c=localStorage.getItem(`color-${i}`);a&&k(a),e&&y(e),c&&(f(c),g(c)),setTimeout(()=>{document.querySelectorAll(".modal-content textarea").forEach(R=>{R.parentNode.dataset.replicatedValue=R.value})},0)},[i,s]);const _=o.useCallback(e=>{D||(e.ctrlKey&&e.key==="Enter"?(d&&j(""),$(),C(!0)):e.altKey&&e.key==="Enter"?(d&&j(""),H(),C(!0)):e.ctrlKey&&e.key.toLowerCase()==="s"?(e.preventDefault(),document.querySelector(".modal-save").focus(),P(),C(!0)):e.ctrlKey&&e.key.toLowerCase()==="f"&&(e.preventDefault(),document.querySelector(".search-input").focus(),C(!0)),setTimeout(()=>{C(!1)},100))},[d,$,H,D]);o.useEffect(()=>(document.addEventListener("keydown",_),()=>{document.removeEventListener("keydown",_)}),[_]),o.useEffect(()=>{s&&h()},[s,h]),o.useEffect(()=>{var e;T.current.length>0&&(T.current.forEach(a=>{a&&(a.style.height="auto")}),(e=T.current[T.current.length-1])==null||e.focus())},[r.length]),o.useEffect(()=>{const e=document.querySelector(".modal-content");e&&(e.style.borderTopColor=M)},[M]);const ee=o.useCallback(async(e,a)=>{try{const c=await fetch("http://localhost:3000/run-script",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({testCaseId:e})}),m=await c.json();if(c.ok&&m.result!=""){N.success("Python script executed successfully!",{autoClose:1e3});const R=m.result,K=R.match(/(\| PASS \|)/),J=R.match(/(\| FAIL \|)/);let w;K?w="passed":J?w="failed":w=a,z(e,w)}else if(m.result=="")N.error(`Suite 'Testsuites' contains no tests or tasks matching tag ${e}.`,{autoClose:1e3}),z(e,"blocked");else throw new Error("Failed to execute script: "+m.message)}catch(c){console.error("Error running Python script:",c),N.error("Failed to execute Python script.",{autoClose:1e3})}},[z,P]);return t.jsx(t.Fragment,{children:s&&t.jsx("div",{className:"modal-overlay z-0 select-none",onClick:u,children:t.jsxs("div",{className:"modal-content bg-[#1C1C1E] flex flex-col max-h-[90vh] min-w-[70%] border-t-4",style:{borderColor:b},onClick:e=>e.stopPropagation(),children:[t.jsx("span",{className:"close bg-inherit text-white text-5xl hover:bg-rose-500",onClick:u,children:"Ã—"}),t.jsxs("div",{className:"flex items-center",children:[t.jsx("input",{type:"text",className:"bg-inherit text-slate-200 font-bold p-1 rounded mr-5 w-2/3 text-xl focus:outline focus:outline-white",value:v,onChange:e=>k(e.target.value),placeholder:"Node Label"}),t.jsxs("div",{className:"flex items-center w-fit space-x-3 px-2 ml-10",children:[t.jsx("button",{onClick:()=>B({target:{value:F.DEFAULT}}),className:`w-8 h-8 rounded border-2 ${b===F.DEFAULT?" border-[#FAF9F6]":"border-gray-500"}`,style:{backgroundColor:F.DEFAULT},"aria-label":"DEFAULT"}),t.jsx("button",{onClick:()=>B({target:{value:F.SECOND}}),className:`w-8 h-8 rounded border-2 ${b===F.SECOND?" border-[#FAF9F6]":"border-gray-500"}`,style:{backgroundColor:F.SECOND},"aria-label":"SECOND"}),t.jsx("button",{onClick:()=>B({target:{value:F.THIRD}}),className:`w-8 h-8 rounded border-2 ${b===F.THIRD?" border-[#FAF9F6]":"border-gray-500"}`,style:{backgroundColor:F.THIRD},"aria-label":"THIRD"})]})]}),t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("label",{className:"p-2 rounded flex items-center border-gray-600 cursor-pointer space-x-4 ",children:[t.jsx("input",{type:"checkbox",onChange:Z,checked:S.length===r.length&&r.length>0}),t.jsx("span",{className:"text-white",children:"Select All"})]}),t.jsx("input",{type:"text",className:"search-input placeholder:italic p-1 px-3 text-sm text-white rounded border border-gray-600 bg-inherit",placeholder:"Search keywords...",value:d,onChange:e=>j(e.target.value)})]}),t.jsx("hr",{className:"mt-2 border-gray-600 border-1"}),d&&t.jsxs("label",{className:"text-gray-400 text-xs",children:[U.length," test case",U.length>1?"s":""," found"]}),t.jsxs("header",{className:"test-header flex text-center text-white p-2 divide-x divide-gray-600 border-b border-gray-600",children:[t.jsx("div",{className:"w-[10%]",children:"Test ID"}),t.jsx("div",{className:"w-[60%]",children:"Test Case"}),t.jsx("div",{className:"w-[15%]",children:"Status"}),t.jsx("div",{className:"w-[12%] ml-auto",children:"Automation"})]}),t.jsx("div",{className:"modal-body overflow-y-auto pb-[10px] divide-y divide-dashed",children:U.map((e,a)=>t.jsx(xe,{testCase:e,onChange:c=>L(e.id,c),onStatusChange:c=>z(e.id,c),onCheckboxChange:()=>G(e.id),isChecked:S.includes(e.id),ref:c=>T.current[r.findIndex(m=>m.id===e.id)]=c,onClick:()=>Q(r.findIndex(c=>c.id===e.id)),runAutomation:()=>ee(e.id,e.status)},e.id))}),t.jsxs("div",{className:"button-container sticky bottom-0 left-0 right-0 bg-[#1C1C1E] pt-5 space-x-3 z-10",children:[t.jsx("button",{className:"p-2 rounded w-12 bg-[#3e3e3e] hover:bg-[#2980B9]",onClick:$,children:t.jsx(O,{icon:oe,size:"lg",color:"white"})}),t.jsx("button",{className:"modal-save p-2 rounded w-12 bg-[#3e3e3e] hover:bg-[#2980B9]",onClick:P,children:t.jsx(O,{icon:ae,size:"lg",color:"white"})}),t.jsx("button",{className:`p-2 rounded w-12 ${S.length>0?"bg-red-600 hover:bg-red-800":"bg-gray-600 cursor-not-allowed"}`,onClick:V,disabled:S.length===0,style:{cursor:S.length===0?"not-allowed":"pointer"},children:t.jsx(O,{icon:le,size:"lg",color:"white"})})]})]})})})},Se=me,pe=({isOpen:s,onClose:u,onSelectVersion:i})=>{const[l,x]=o.useState([]);return o.useEffect(()=>{s&&fetch("http://localhost:3000/versions.json").then(n=>{if(!n.ok)throw new Error("Failed to fetch flow data");return n.json()}).then(n=>{if(n.versions){const v=n.versions.sort((k,b)=>new Date(b.timestamp)-new Date(k.timestamp));x(v)}else console.error("Invalid data structure:",n)}).catch(n=>{console.error("Failed to fetch versions:",n)})},[s]),s?t.jsx("div",{className:"modal-overlay z-0 select-none text-slate-200",onClick:u,children:t.jsxs("div",{className:"modal-content bg-[#1C1C1E] flex flex-col max-h-[90vh] min-w-[500px]",onClick:n=>n.stopPropagation(),children:[t.jsxs("div",{className:"modal-header",children:[t.jsx("h2",{className:"font-bold text-xl",children:"Version History"}),t.jsx("span",{className:"close bg-inherit text-white text-5xl hover:bg-rose-500",onClick:u,children:"Ã—"}),t.jsx("hr",{className:"mb-4 mt-2 border-gray-600 border-1"})]}),t.jsx("div",{className:"modal-body divide-y divide-dashed ",children:l.length===0?t.jsx("p",{children:"No versions available."}):t.jsx("ul",{className:"space-y-3 peer",children:l.map((n,p)=>t.jsx("li",{children:t.jsxs("button",{className:"link-button border border-gray-600 w-full px-2 text-right pr-7 py-2 rounded hover:bg-gray-800 hover:border-white",onClick:()=>i(n.flowData),children:[t.jsx(O,{icon:re,className:"float-left peer-hover:pl-10",size:"lg",color:"white"}),ne(new Date(n.timestamp),"MMMM dd, h:mm a")]})},p))})})]})}):null},je=pe,Ce=()=>{const s=o.useCallback(()=>{N.error("No node selected to delete.",{autoClose:1e3})},[]),u=o.useCallback(()=>{N.success("Node Deleted.",{autoClose:1e3})},[]),i=o.useCallback(()=>{N.error("Server Save Failed: Unable to save changes.",{autoClose:1e3})},[]),l=o.useCallback(()=>{N.success("Changes saved successfully!",{autoClose:1e3})},[]),x=o.useCallback(()=>{N.error("Local Save Failed: Unable to save changes locally.",{autoClose:1e3})},[]),n=o.useCallback(()=>{N.success("Changes saved locally!",{autoClose:1e3})},[]);return{toastDelete:s,toastDeleteSuccess:u,toastSaveError:i,toastSaveSuccess:l,toastSaveErrorLocal:x,toastSaveLocalSuccess:n}},ve=(s,u,i,l,x,n,p,v)=>{const{toastDelete:k,toastDeleteSuccess:b,toastSaveError:f,toastSaveSuccess:r}=Ce(),y=o.useCallback(()=>{const g=s[s.length-1],d=g?g.position:{x:0,y:0},j={id:X(),position:{x:d.x+100,y:d.y+100},data:{label:`Test Scenario ${s.length+1}`,testCases:[]},sourcePosition:"right",targetPosition:"left",type:"customNode"};u(D=>[...D,j])},[s,u]),S=o.useCallback(()=>{const g=s[s.length-1],d=g?g.position:{x:0,y:0},j={id:X(),position:{x:d.x+100,y:d.y+100},type:"connector",data:{label:`${s.length+1}`},sourcePosition:"right",targetPosition:"left"};u(D=>[...D,j])},[s,u]),I=o.useCallback(async()=>{console.time("Export to Excel");const g=new ce.Workbook,d=new Set,j=E=>{const A=E.replace(/[^a-zA-Z0-9_]/g,"_").slice(0,31);let h=A,P=1;for(;d.has(h);)h=`${A}_${P}`,P++,h.length>31&&(h=h.slice(0,31));return d.add(h),h};for(const E of s)if(E.data.testCases&&E.data.testCases.length>0){const A=E.data.label||`Sheet${s.indexOf(E)+1}`,h=j(A),P=E.data.testCases||[];console.log(`Processing node: ${A}`),console.log("Test Cases:",P);const B=g.addWorksheet(h);B.addRow(["Test ID","Test Case","Status"]),P.forEach((L,$)=>{B.addRow([$+1,L.content,L.status,L.description||""])}),(()=>{B.columns.forEach(L=>{let $=0;L.eachCell({includeEmpty:!0},z=>{const V=z.value?z.value.toString().length:0;V>$&&($=V)}),L.width=$})})(),console.timeEnd(`Creating sheet for ${h}`)}console.timeEnd("Export to Excel");const D=await g.xlsx.writeBuffer(),C=new Blob([D],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});ie.saveAs(C,"test_cases.xlsx"),console.log("File saved!")},[s]),T=o.useCallback(()=>{l?(u(g=>g.filter(d=>d.id!==l.id)),i(g=>g.filter(d=>d.source!==l.id&&d.target!==l.id)),b(),x(!1),n(null)):k()},[l,u,i,x]),M=o.useCallback(()=>{if(p){const g=p.toObject(),d=v(g.nodes),j=JSON.stringify({...g,testCaseStats:d},null,4),D=C=>{const A={timestamp:new Date().toISOString(),flowData:C};fetch("http://localhost:3000/flow/saveVersion",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(A)}).then(h=>h.json()).then(h=>{h?console.log("Version saved to server:",h.message):f()}).catch(h=>{console.error("Failed to save version to server:",h),f()})};fetch("http://localhost:3000/flow",{method:"POST",headers:{"Content-Type":"application/json"},body:j}).then(C=>C.json()).then(C=>{C?(r(),D(j)):f()}).catch(C=>{console.error("Failed to save flow data to server:",C),f()})}else f()},[p,v,f,r]);return{addNode:y,addConnectorNode:S,exportToExcel:I,deleteSelectedNode:T,onSave:M}},Ne=ve;Y.register(de,ue,he,fe);const ye={id:"centerText",beforeDraw:s=>{const{width:u,height:i,ctx:l}=s;l.save();const x=(i/160).toFixed(2);l.font=`${x}em sans-serif`,l.textBaseline="middle",l.textAlign="center";const p=`${s.config.data.datasets[0].data.reduce((f,r)=>f+r,0)}`,v="Test Cases",k=u/2,b=i/2;l.fillStyle="#fff",l.fillText(p,k,b-30),l.font="2em sans-serif",l.fillText(v,k,b+20),l.restore()}};Y.register(ye);const we=({isOpen:s,onClose:u,testCaseData:i})=>{if(!s)return null;const{notstarted:l,passed:x,failed:n,blocked:p,notapplicable:v}=i,k={labels:["Not Started","Passed","Failed","Blocked","Not Applicable"],datasets:[{label:"Test Case Status",data:[l,x,n,p,v],backgroundColor:["rgba(254, 240, 138, 0.6)","rgba(151, 189, 97, 0.6)","rgba(253, 164, 175, 0.6)","rgba(199, 210, 254, 0.6)","rgba(209, 213, 219, 0.6)"],borderColor:["rgba(254, 240, 138, 1)","rgba(151, 189, 97, 1)","rgba(253, 164, 175, 1)","rgba(199, 210, 254, 1)","rgba(209, 213, 219, 1)"],borderWidth:1}]},b={responsive:!0,plugins:{legend:{position:"bottom",labels:{boxHeight:10,boxWidth:20,padding:10}},tooltip:{callbacks:{label:function(f){const r=f.label||"",y=f.raw||0;return`${r}: ${y}`}}},datalabels:{color:"#fff",formatter:(f,r)=>{const y=r.chart._metasets[0].total,S=f/y*100;return S%1===0?`${S.toFixed(0)}%`:`${S.toFixed(2)}%`},align:"center",offset:-10,borderRadius:3,font:{weight:"bold",size:20,family:"Space Mono"}}},layout:{padding:{top:10}}};return t.jsx("div",{className:"modal-overlay z-50 select-none",onClick:u,children:t.jsxs("div",{className:"modal-content bg-[#1C1C1E] flex flex-col p-6 max-h-[90vh] min-w-[500px] relative",onClick:f=>f.stopPropagation(),children:[t.jsxs("div",{className:"flex justify-between items-center mb-5",children:[t.jsx("h2",{className:"text-xl font-semibold text-white",children:"Test Status Chart"}),t.jsx("span",{className:"close bg-inherit text-white text-5xl hover:bg-rose-500",onClick:u,children:"Ã—"})]}),t.jsx("div",{className:"flex justify-center items-center flex-1",children:t.jsx(be,{data:k,options:b})})]})})},Te=we;export{Ne as B,Se as M,Te as P,je as V};
