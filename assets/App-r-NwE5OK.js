import{j as e,H as B,n as ie,u as de,o as ue,r as o,q as he,s as pe,t as xe,w as Ce,M as be,x as fe,P as ge,F as f,d as me,y as je,z as ye,G as Ee,I as we,J as ke,K as ve,L as Ne,Q as Se}from"./vendor-BFaFKivp.js";import{B as Be,V as ze,P as Fe,M as Oe}from"./components-CrSWwAWx.js";const Pe=({data:p,selected:l})=>{const{label:x,testCases:C,color:c}=p,i=C.length,b=l?"#2980B9":"#373737",s={background:l?"#373737":"#2980B9",width:"13px",height:"13px",border:"3px solid",borderColor:b},d={outline:`3px solid ${b}`,background:`${c||"#1c1c1e"}`};return e.jsxs("div",{className:"text-xs outline rounded relative p-2 text-[#ECF0F1] max-w-[150px] text-center",style:d,children:[e.jsx("div",{children:x}),e.jsx(B,{type:"source",position:"right",style:s}),e.jsx(B,{type:"target",position:"left",style:s}),i>0&&e.jsx("div",{className:"absolute top-[-10px] right-[-10px] w-[1.5rem] h-[1.5rem] rounded-full bg-[#E0E0E0] text-slate-700 flex items-center justify-center text-xs",children:i})]})},Te=Pe,Ve=({data:p,selected:l})=>{const{label:x}=p,C=l?"#2980B9":"#373737",i={background:l?"#373737":"#2980B9",width:"13px",height:"13px",border:"3px solid",borderColor:C},b={outline:`3px solid ${C}`};return e.jsxs("div",{className:"text-[#ECF0F1] text-xs rounded-full w-[50px] h-[50px] flex justify-center items-center bg-[#34495E]",style:b,children:[e.jsx("div",{children:x}),e.jsx(B,{type:"source",position:"right",style:i}),e.jsx(B,{type:"target",position:"left",style:i})]})},Me=Ve,De=({id:p,sourceX:l,sourceY:x,targetX:C,targetY:c,sourcePosition:i,targetPosition:b,markerEnd:g,data:s})=>{const[d,j,z]=ie({sourceX:l,sourceY:x,targetX:C,targetY:c,sourcePosition:i,targetPosition:b});return e.jsxs(e.Fragment,{children:[e.jsx("path",{id:p,className:"stroke-[#BDC3C7] stroke-[2] fill-none",d,markerEnd:g}),(s==null?void 0:s.label)&&e.jsx("text",{x:j,y:z,style:{fontSize:12},textAnchor:"middle",children:s.label})]})},Ae=De;function $e(){var D,A,H;const[p,l,x]=de([]),[C,c,i]=ue([]),[b,g]=o.useState(!1),[s,d]=o.useState(null),[j,z]=o.useState(null),{setViewport:N}=he(),[G,O]=o.useState(!1),[R,P]=o.useState(!1),[T,V]=o.useState(!1),L=o.useCallback(()=>O(!0),[]),F=o.useCallback(()=>O(!1),[]),U=o.useCallback(()=>P(!0),[]),q=o.useCallback(()=>P(!1),[]),J={customNode:Te,connector:Me},Y={customEdge:Ae},[m,w]=o.useState({total:0,notstarted:0,passed:0,failed:0,blocked:0,notapplicable:0}),[K,Q]=o.useState(!1),k=o.useRef(null),W=o.useCallback(()=>{Q(a=>!a)},[]),v=o.useCallback(a=>{const t={total:0,notstarted:0,passed:0,failed:0,blocked:0,notapplicable:0};return a.forEach(n=>{n.data&&n.data.testCases&&n.data.testCases.forEach(r=>{t[r.status]!==void 0&&(t[r.status]+=1)})}),t.total=Object.values(t).reduce((n,r)=>n+r,0),t},[]),{addNode:X,addConnectorNode:Z,exportToExcel:_,deleteSelectedNode:ee,onSave:M}=Be(p,l,c,s,g,d,j,v),se=o.useCallback(()=>{M(),V(!1)},[M]);o.useEffect(()=>{const a=t=>{if(T){const n="You have unsaved changes. Are you sure you want to leave?";return t.returnValue=n,n}};return window.addEventListener("beforeunload",a),()=>{window.removeEventListener("beforeunload",a)}},[T]);const te=o.useCallback(a=>{x(a),V(!0)},[x]);o.useEffect(()=>{(async()=>{try{const t=await fetch("https://code-me-n0t.github.io/TestFlowManager/flow.json");if(t.ok){const n=await t.json(),{x:r=0,y=0,zoom:E=1}=n.viewport||{},u=(n.nodes||[]).map(h=>{var I,$;return{...h,position:{x:typeof((I=h.position)==null?void 0:I.x)=="number"?h.position.x:0,y:typeof(($=h.position)==null?void 0:$.y)=="number"?h.position.y:0}}}),S=(n.edges||[]).map(h=>({...h}));l(u),c(S),N({x:r,y,zoom:E}),n.nodes&&w(v(n.nodes)),j&&j.fitView()}else console.warn("Failed to load flow data: Check the flow.json")}catch(t){console.error("Failed to load flow data:",t)}})()},[l,c,N,w,j]);const oe=o.useCallback(a=>c(t=>pe({...a,animated:!0,type:"customEdge"},t)),[c]),ne=o.useCallback((a,t,n)=>{l(r=>{const y=r.map(u=>u.id===s.id?{...u,data:{...u.data,label:t,testCases:a,color:n},style:{...u.style,backgroundColor:n},type:"customNode"}:u),E=v(y);return w(E),y})},[s,l,w]),ae=o.useCallback((a,t)=>{k.current?(clearTimeout(k.current),k.current=null,g(!0)):k.current=setTimeout(()=>{k.current=null},200),l(n=>n.map(r=>r.id===t.id?{...r,selected:!0}:{...r,selected:!1})),d(t)},[l]),le=o.useCallback(()=>{g(!0)},[]),re=o.useCallback(()=>{g(!1),d(null)},[]),ce=o.useCallback(a=>{try{const t=typeof a=="string"?JSON.parse(a):a,n=t.nodes||[],r=t.edges||[],y=t.viewport||{x:0,y:0,zoom:1};l(n),c(r),N(y);const E=s==null?void 0:s.id;if(E){const S=n.find(h=>h.id===E);d(S||null)}else d(null);const u=v(n);w(u),F()}catch(t){console.error("Error selecting version:",t)}},[s,l,c,N,v,F]);return e.jsxs("div",{style:{height:"100vh",width:"100%"},children:[e.jsxs(xe,{colorMode:"dark",nodes:p,nodeTypes:J,onNodesChange:te,edges:C,edgeTypes:Y,onEdgesChange:i,onConnect:oe,onInit:z,fitView:!0,zoomOnScroll:!1,zoomOnDoubleClick:!1,onNodeClick:ae,onNodeDoubleClick:le,children:[e.jsx(Ce,{}),e.jsx(be,{}),e.jsx(fe,{}),e.jsxs(ge,{position:"top-left panel",className:"flex flex-col space-y-4",children:[e.jsxs("div",{className:"button-container flex space-x-2",children:[e.jsx("button",{className:"delete p-2 rounded bg-[#3E3E3E] hover:bg-red-600 size-12",onClick:ee,children:e.jsx(f,{icon:me,size:"lg",color:"white"})}),e.jsx("button",{className:"version-history p-2 rounded bg-[#3E3E3E] hover:bg-[#2980B9] size-12",onClick:L,children:e.jsx(f,{icon:je,size:"lg",color:"white"})}),e.jsx("button",{className:"download rounded rounded bg-[#3E3E3E] hover:bg-[#2980B9] size-12",onClick:_,children:e.jsx(f,{icon:ye,size:"lg",color:"white"})}),e.jsx("button",{className:"add p-2 rounded bg-[#3E3E3E] hover:bg-[#2980B9] size-12",onClick:X,children:e.jsx(f,{icon:Ee,size:"lg",color:"white"})}),e.jsx("button",{className:"connector p-2 rounded bg-[#3E3E3E] hover:bg-[#2980B9] size-12",onClick:Z,children:e.jsx(f,{icon:we,size:"lg",color:"white"})}),e.jsx("button",{className:"save p-2 rounded bg-[#3E3E3E] hover:bg-[#2980B9] size-12",onClick:se,children:e.jsx(f,{icon:ke,size:"lg",color:"white"})}),e.jsx("button",{className:"chart p-2 rounded bg-[#3E3E3E] hover:bg-[#2980B9] size-12",onClick:U,children:e.jsx(f,{icon:ve,size:"lg",color:"white"})})]}),e.jsxs("div",{className:"w-[70%]",children:[e.jsxs("div",{className:"flex justify-between items-center text-sm p-2 bg-[#2d2d2d] opacity-70 rounded text-white",children:[e.jsxs("p",{children:["Total Test Count: ",m.total]}),e.jsx("button",{className:"dropdown-button p-2 rounded bg-[#3E3E3E] hover:bg-[#2980B9] flex items-center",onClick:W,children:e.jsx(f,{icon:Ne,size:"lg",color:"white"})})]}),K&&e.jsxs("div",{className:"dropdown-menu mt-2 bg-[#2d2d2d] p-2 opacity-70 rounded text-white",children:[e.jsxs("p",{children:["Not Started: ",m.notstarted]}),e.jsxs("p",{children:["Passed: ",m.passed]}),e.jsxs("p",{children:["Failed: ",m.failed]}),e.jsxs("p",{children:["Blocked: ",m.blocked]}),e.jsxs("p",{children:["Not Applicable: ",m.notapplicable]})]})]})]})]}),e.jsx(Se,{}),e.jsx(ze,{isOpen:G,onClose:F,onSelectVersion:ce}),e.jsx(Fe,{isOpen:R,onClose:q,testCaseData:m}),e.jsx(Oe,{isOpen:b,onClose:re,nodeId:s==null?void 0:s.id,nodeLabel:((D=s==null?void 0:s.data)==null?void 0:D.label)||"",testCases:((A=s==null?void 0:s.data)==null?void 0:A.testCases)||[],onSave:ne,borderColor:((H=s==null?void 0:s.data)==null?void 0:H.color)||"#1C1C1E"})]})}export{$e as default};
